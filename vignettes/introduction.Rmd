---
title: "Introduction to parlitools"
author: "Evan Odell"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to parlitools}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Creating a Hexagonal Map

Create a hexagonal map of all current constituency MPs, at the time Parliament was dissolved for the 2017 General Election.

Note, this uses packages that are not imported by `parlitools`, namely `leaflet`, `htmltools` and `sf`. It also requires a version of `mnis` > 0.2.3. You may have to install the development version of `mnis`:

```
#install.packages("devtools")
devtools::install_github("evanodell/mnis")
```

```{r fig.width= 8, fig.height=4,message=FALSE}
  library(leaflet)
  library(sf)
  library(dplyr)
  library(hansard)
  devtools::install_github("evanodell/mnis") # If installed version of `mnis` is v0.2.3 or less
  library(mnis)
  west_hex_map <- parlitools::west_hex_map
  
  constit <- constituencies() #Get list of current consituencies
  
  current <- mnis_eligible(house="commons") #Get list of current MPs
  
  current_mps <- left_join(current, constit, by = c("member_from"= "label_value")) ## Join together
  
  party_colour <- parlitools::party_colour ## Party colour data
  
  current_mps_colours <- left_join(current_mps, party_colour, by = "party_id") ## Join to current MP data
  
  west_hex_map2 <- left_join(west_hex_map, current_mps_colours, by = "gss_code") ## Join to hexagon map
  
  elect2015 <- election_results(382386) # Get 2015 General Election Results
  
  west_hex_map2 <- left_join(west_hex_map2, elect2015, by = c("about"= "constituency_about")) ## Join together

  # Creating map labels
  labels <- paste0(
   "<strong>", west_hex_map2$member_from, "</strong>", "</br>",
    west_hex_map2$party_name, "</br>",
    west_hex_map2$display_as, "</br>",
    "2015 Result: ", west_hex_map2$result_of_election, "</br>",
    "2015 Majority: ", west_hex_map2$majority
  ) %>% lapply(htmltools::HTML)
  
  # Creating the map itself
  leaflet(
    west_hex_map2) %>%
    addPolygons(
      color = "grey",
      weight=0.75,
      opacity = 0.5,
      fillOpacity = 1,
      fillColor = ~party_colour,
      label=labels) 
```

